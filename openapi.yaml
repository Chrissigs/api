  Header:
    type: object
    required:
      - timestamp
      - bank_id
      - transaction_id
      - fund_id
    properties:
      timestamp:
        type: string
        format: date-time
        example: "2025-11-22T20:00:00Z"
      bank_id:
        type: string
        example: "BANK-001"
      transaction_id:
        type: string
        example: "TXN-123"
      fund_id:
        type: string
        example: "FUND_DEMO_01"
        description: "Target Fund ID for routing to specific Fund Administrator"
        zk_proof:
          type: object
          description: "Zero-Knowledge Proof (Groth16) verifying identity without revealing PII"
          properties:
            pi_a:
              type: array
              items: { type: string }
            pi_b:
              type: array
              items: { type: array, items: { type: string } }
            pi_c:
              type: array
              items: { type: string }
            protocol:
              type: string
              example: "groth16"
        public_signals:
          type: array
          items: { type: string }
          description: "Public outputs of the ZK circuit (e.g. [1] for 'Valid Jurisdiction')"
        Nm:
          type: object
          description: "ISO 20022 Name structure for SEPA compliance"
          properties:
            FrstNm:
              type: string
              example: "Johnathan"
              description: "First Name"
            Srnm:
              type: string
              example: "Doe"
              description: "Surname"
          x-iso-20022-mapping: "Nm"
        PstlAdr:
          type: object
          description: "ISO 20022 Postal Address for SEPA compliance"
          properties:
            StrtNm:
              type: string
              example: "123 Main Street"
              description: "Street Name"
            TwnNm:
              type: string
              example: "George Town"
              description: "Town Name"
            Ctry:
              type: string
              example: "KY"
              description: "Country (ISO 3166-1 alpha-2)"
            PstCd:
              type: string
              example: "KY1-1234"
              description: "Postal Code"
          x-iso-20022-mapping: "PstlAdr"
        date_of_birth:
          type: string
          format: date
          example: "1980-01-01"
          x-iso-20022-mapping: "BirthDt"
        nationality:
          type: string
          example: "KY"
          x-iso-20022-mapping: "CtryOfRes"
        tax_residency:
          type: array
          description: "CRS-compliant multi-jurisdiction tax residency vector"
          items:
            type: object
            required:
              - country
              - tin
            properties:
              country:
                type: string
                pattern: "^[A-Z]{2}$"
                example: "KY"
                description: "Country code (ISO 3166-1 alpha-2)"
              tin:
                type: string
                pattern: "^[A-Za-z0-9+/]+={0,2}$"
                example: "SGVsbG8gV29ybGQgRW5jcnlwdGVk..."
                description: "Tax Identification Number (RSA-4096-OAEP encrypted for FATCA/CRS reporting)"
                x-encryption-algorithm: "RSA-4096-OAEP"
          example:
            - country: "KY"
              tin: "dGluLWV4YW1wbGUtZW5jcnlwdGVk"
            - country: "US"
              tin: "dGluLXVzLWV4YW1wbGUtZW5jcnlwdGVk"
          x-iso-20022-mapping: "TaxRes"

    ComplianceWarranty:
      type: object
      required:
        - kyc_status
        - screening_status
        - warranty_token
      properties:
        kyc_status:
          type: string
          enum: [VERIFIED, PENDING, REJECTED]
          example: "VERIFIED"
        screening_status:
          type: string
          example: "CLEAR"
        warranty_token:
          type: string
          description: SHA-256 hash or similar token.
          example: "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"
        contract_id:
          type: string
          description: "Reference to the active Deed of Reliance in the Legal Registry"
          example: "DEED-2025-001"
